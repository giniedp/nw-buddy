@for (item of rows(); track $index) {
  <div
    class="flex flex-col relative rounded-md outline-2 outline-offset-0 outline-transparent transition-all"
    [class.hover:outline-primary]="isSlotEditable(item)"
    [class.hover:outline-offset-4]="isSlotEditable(item)"
    [class.hover:cursor-pointer]="isSlotEditable(item)"
    (click)="editPerkClicked(item)"
  >
    @if (!editable() && item.perkIdOld) {
      @for (row of item.explainOld; track $index) {
        <nwb-item-perk
          [icon]="row.icon"
          [socket]="item.socket"
          [empty]="item.empty"
          [explanation]="row"
          [linkPerkId]="item.perkId"
          class="filter grayscale-100 opacity-50 line-through"
        />
      }
    }
    @for (row of item.explain; track $index) {
      <nwb-item-perk
        [icon]="row.icon"
        [socket]="item.socket"
        [empty]="item.empty"
        [explanation]="row"
        [linkPerkId]="editable() ? null : item.perkId"
      />
    }
    @if (!item.perk && item.bucket) {
      <nwb-item-perk
        [icon]="'assets/icons/item/crafting_perkbackground.png'"
        [iconText]="item.bucket.PerkChance | percent"
      >
        Random Perk
      </nwb-item-perk>
    }
    @if (!item.perk && !item.bucket) {
      <nwb-item-perk
        [linkPerkId]="editable() ? null : item.perkId"
        [icon]="'assets/icons/item/crafting_perkbackground.png'"
        [iconText]="'?'"
      >
        – Missing –
      </nwb-item-perk>
    }
    @if (isSlotEditable(item)) {
      <span class="absolute top-1 -left-3 opacity-50 screenshot-hidden">
        <nwb-icon [icon]="iconEdit" class="w-3 h-3" />
      </span>
    }
    <span class="absolute top-0 -right-3 screenshot-hidden flex flex-col gap-1 leading-none">
      @if (editable() && (item.violatesExclusivity || item.violatesItemClass || item.activationCooldown)) {
        @if (item.violatesExclusivity) {
          <span class="text-error cursor-help opacity-50" [tooltip]="tip">
            <nwb-icon [icon]="iconWarn" class="w-3 h-3" />
            <ng-template #tip>
              <div role="alert" class="alert alert-error alert-soft">
                <nwb-icon [icon]="iconWarn" class="w-4 h-4" />
                <div>
                  <h3 class="font-bold">Exclusivity violation</h3>
                  <div>At least 2 perks have the same <b>Exclusive Label</b></div>
                </div>
              </div>
            </ng-template>
          </span>
        }
        @if (item.violatesItemClass) {
          <span class="text-warning cursor-help opacity-50" [tooltip]="tip">
            <nwb-icon [icon]="iconWarn" class="w-3 h-3" />
            <ng-template #tip>
              <div role="alert" class="alert alert-warning alert-soft">
                <nwb-icon [icon]="iconWarn" class="w-4 h-4" />
                <div>
                  <h3 class="font-bold">Item class volation</h3>
                  <div>The perks is not designed to roll on this item.</div>
                </div>
              </div>
            </ng-template>
          </span>
        }
        @if (item.activationCooldown) {
          <span class="text-info cursor-help opacity-50" [tooltip]="tip">
            <nwb-icon [icon]="iconTime" class="w-3 h-3" />
            <ng-template #tip>
              <div role="alert" class="alert alert-info alert-soft">
                <nwb-icon [icon]="iconTime" class="w-4 h-4" />
                <div>{{ item.activationCooldown | number }}s actionvation cooldown</div>
              </div>
            </ng-template>
          </span>
        }
      }
      @if (!editable() && item.perkIdOld) {
        <span class="text-info cursor-help opacity-50" [tooltip]="tip">
          <nwb-icon [icon]="iconWarn" class="w-3 h-3" />
          <ng-template #tip>
            <div role="alert" class="alert alert-info alert-soft">
              <nwb-icon [icon]="iconWarn" class="w-4 h-4" />
              <div>
                <h3 class="font-bold">Perk replacement</h3>
                <div>Has been replaced due to an ingame bug or change of system</div>
              </div>
            </div>
          </ng-template>
        </span>
      }
    </span>
  </div>
}
